{"version":3,"file":"babylonscene.nobabylon.js","sources":["src/eventlistener.js","src/addons.js","src/url-resolver.js","src/baseapplication.js","src/defaultstage.js","src/babylonscene.js"],"sourcesContent":["export default class EventListener {\n    constructor() {\n        /**\n         * event listeners\n         * @type {Array}\n         * @private\n         */\n        this._listeners = [];\n    }\n\n    /**\n     * add event listener\n     * @param type\n     * @param cb\n     * @returns {{type: *, callback: *}}\n     */\n    addEventListener(type, cb) {\n        let listener = { type: type, callback: cb };\n        this._listeners.push(listener);\n        return listener;\n    }\n\n    /**\n     * remove event listener\n     * @param listener\n     */\n    removeEventListener(listener) {\n        for (let c = 0; c < this._listeners.length; c++) {\n            if (listener === this._listeners[c]) {\n                this._listeners.splice(c, 0);\n                return;\n            }\n        }\n    }\n\n    /**\n     * trigger event\n     * @param custom event\n     */\n    triggerEvent(ce) {\n        this._listeners.forEach( function(l) {\n            if (ce.type === l.type) {\n                l.callback.apply(this, [ce]);\n            }\n        });\n    }\n}\n","export const pointer = {\n    add(scope) {\n        scope.stage.scene.onPointerObservable.add((pointerInfo) => {\n            if (scope.onPointer) {\n                scope.onPointer(pointerInfo);\n            }\n\n            if (scope.onMeshPointer) {\n                const pick = scope.stage.scene.pick(pointerInfo.event.clientX, pointerInfo.event.clientY);\n                if (pick.hit) {\n                    scope.onMeshPointer(pick, pointerInfo);\n                }\n            }\n        });\n    }\n};\n\nexport const xrcontrollers = {\n    add(scope) {\n        scope.xrcontrollers = [];\n        scope._xrcontrollerButtonStates = [];\n\n        const notifyApp = function(eventtype, button, controller) {\n            const ray = controller.getForwardRay(99999);\n            const pick = scope.stage.scene.pickWithRay(ray);\n            if (scope.onControllerEvent) {\n                scope.onControllerEvent(eventtype, button, controller, pick);\n            }\n        };\n\n        scope.stage.webxr.then( result => {\n            const helper = result;\n            if (helper.fallbackToWebVR) {\n                helper.enableInteractions();\n                helper.onControllerMeshLoadedObservable.add(controller => {\n                    controller.onMainButtonStateChangedObservable.add((button) => {\n                        notifyApp('mainbutton', button, controller);\n                    });\n                    controller.onTriggerStateChangedObservable.add((button) => {\n                        notifyApp('trigger', button, controller);\n                    });\n                    controller.onSecondaryButtonStateChangedObservable.add((button) => {\n                        notifyApp('secondarybutton', button, controller);\n                    });\n                    controller.onPadStateChangedObservable.add( (button) => {\n                        notifyApp('padstate', button, controller);\n                    });\n                    controller.onPadValuesChangedObservable.add( (button) => {\n                        notifyApp('padvalue', button, controller);\n                    });\n\n                    scope.xrcontrollers.push(controller);\n                });\n            }\n        });\n    }\n};\n\n","/**\n * from https://github.com/btford/url-resolver.js\n */\n\nexport {urlResolve, urlIsSameOrigin}\n\nvar urlParsingNode = document.createElement(\"a\");\nvar originUrl = urlResolve(window.location.href, true);\n\n\n/**\n *\n * Implementation Notes for non-IE browsers\n * ----------------------------------------\n * Assigning a URL to the href property of an anchor DOM node, even one attached to the DOM,\n * results both in the normalizing and parsing of the URL.  Normalizing means that a relative\n * URL will be resolved into an absolute URL in the context of the application document.\n * Parsing means that the anchor node's host, hostname, protocol, port, pathname and related\n * properties are all populated to reflect the normalized URL.  This approach has wide\n * compatibility - Safari 1+, Mozilla 1+, Opera 7+,e etc.  See\n * http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *\n * Implementation Notes for IE\n * ---------------------------\n * IE >= 8 and <= 10 normalizes the URL when assigned to the anchor node similar to the other\n * browsers.  However, the parsed components will not be set if the URL assigned did not specify\n * them.  (e.g. if you assign a.href = \"foo\", then a.protocol, a.host, etc. will be empty.)  We\n * work around that by performing the parsing in a 2nd step by taking a previously normalized\n * URL (e.g. by assigning to a.href) and assigning it a.href again.  This correctly populates the\n * properties such as protocol, hostname, port, etc.\n *\n * IE7 does not normalize the URL when assigned to an anchor node.  (Apparently, it does, if one\n * uses the inner HTML approach to assign the URL as part of an HTML snippet -\n * http://stackoverflow.com/a/472729)  However, setting img[src] does normalize the URL.\n * Unfortunately, setting img[src] to something like \"javascript:foo\" on IE throws an exception.\n * Since the primary usage for normalizing URLs is to sanitize such URLs, we can't use that\n * method and IE < 8 is unsupported.\n *\n * References:\n *   http://developer.mozilla.org/en-US/docs/Web/API/HTMLAnchorElement\n *   http://www.aptana.com/reference/html/api/HTMLAnchorElement.html\n *   http://url.spec.whatwg.org/#urlutils\n *   https://github.com/angular/angular.js/pull/2902\n *   http://james.padolsey.com/javascript/parsing-urls-with-the-dom/\n *\n * @function\n * @param {string} url The URL to be parsed.\n * @description Normalizes and parses a URL.\n * @returns {object} Returns the normalized URL as a dictionary.\n *\n *   | member name   | Description    |\n *   |---------------|----------------|\n *   | href          | A normalized version of the provided URL if it was not an absolute URL |\n *   | protocol      | The protocol including the trailing colon                              |\n *   | host          | The host and port (if the port is non-default) of the normalizedUrl    |\n *   | search        | The search params, minus the question mark                             |\n *   | hash          | The hash string, minus the hash symbol\n *   | hostname      | The hostname\n *   | port          | The port, without \":\"\n *   | pathname      | The pathname, beginning with \"/\"\n *\n */\nfunction urlResolve(url, base) {\n    var href = url;\n\n    /*if (msie) {\n        // Normalize before parse.  Refer Implementation Notes on why this is\n        // done in two steps on IE.\n        urlParsingNode.setAttribute(\"href\", href);\n        href = urlParsingNode.href;\n    }*/\n\n    urlParsingNode.setAttribute('href', href);\n\n    // urlParsingNode provides the UrlUtils interface - http://url.spec.whatwg.org/#urlutils\n    return {\n        href: urlParsingNode.href,\n        protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, '') : '',\n        host: urlParsingNode.host,\n        search: urlParsingNode.search ? urlParsingNode.search.replace(/^\\?/, '') : '',\n        hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, '') : '',\n        hostname: urlParsingNode.hostname,\n        port: urlParsingNode.port,\n        pathname: (urlParsingNode.pathname.charAt(0) === '/')\n            ? urlParsingNode.pathname\n            : '/' + urlParsingNode.pathname\n    };\n}\n\n/**\n * Parse a request URL and determine whether this is a same-origin request as the application document.\n *\n * @param {string|object} requestUrl The url of the request as a string that will be resolved\n * or a parsed URL object.\n * @returns {boolean} Whether the request is for the same origin as the application document.\n */\nfunction urlIsSameOrigin(requestUrl) {\n    var parsed = (isString(requestUrl)) ? urlResolve(requestUrl) : requestUrl;\n    return (parsed.protocol === originUrl.protocol &&\n        parsed.host === originUrl.host);\n}\n","import EventListener from './eventlistener.js';\nimport * as Addons from './addons.js';\nimport {urlResolve} from \"./url-resolver.js\";\n\nexport default class BaseApplication extends EventListener {\n\n    static get Babylon() { return null; }\n\n    constructor(o) {\n        super();\n        if (o.stage) {\n            o.stage.setup(o.canvas, o.config, this).then( stage => {\n                stage.application = this;\n                this.stage = stage;\n                this.config = o.config;\n                this.stage.engine.runRenderLoop(() => {\n                    this.stage.scene.render();\n                    this.onRender(this.stage.engine.getDeltaTime());\n                });\n\n                if (this.config.addons) {\n                    this.config.addons.split(',').forEach(addon => {\n                        this.processAddon(addon);\n                    });\n                }\n\n                this.stage.engine.resize();\n\n                window.addEventListener('resize', () => {\n                    this.stage.engine.resize();\n                    this.onResize();\n                });\n\n                this.triggerEvent(new CustomEvent('ready'));\n                this.onReady();\n            });\n        }\n    }\n\n    async processAddon(path) {\n        if (path.toLowerCase().indexOf('.js') === -1) {\n            // path is a built-in name\n            Addons[path].add(this);\n        } else {\n            const absPath = urlResolve(path);\n            const a = await import(path);\n            a.default.add(this);\n        }\n    }\n\n    onRender(deltaTime) {}\n    onResize() {}\n    onReady() {}\n}\n","import BabylonScene from './babylonscene.js';\n\nexport default {\n    async setup(canvas, config, clazz) {\n        const stage = {\n            canvas: canvas,\n            config: config,\n            app: clazz,\n        };\n        stage.babylon = this.setupBabylon(stage);\n        stage.engine = this.setupEngine(stage);\n        stage.scene = this.setupScene(stage);\n\n        const cameras = this.setupCameras(stage);\n        if (!Array.isArray(cameras))  {\n            stage.cameras = [cameras];\n        }  else {\n            stage.cameras = cameras;\n        }\n\n        const lights = this.setupLights(stage);\n        if (!Array.isArray(lights))  {\n            stage.lights = [lights];\n        }  else {\n            stage.lights = lights;\n        }\n        stage.lights = lights;\n\n        if (config.usewebxr) {\n            stage.webxr = this.setupWebXR(stage);\n        }\n\n        return stage;\n    },\n\n    setupBabylon(stage) {\n        // if user does not specify, auto-detect if BABYLON is present\n        if (!stage.config.useglobalbabylon) {\n            if (window.BABYLON) { return window.BABYLON; }\n        }\n\n        // if user does specify with true or no value, use BABYLON, error if not present\n        if (stage.config.useglobalbabylon === true || stage.config.useglobalbabylon === \"true\") {\n            if (window.BABYLON) {\n                return window.BABYLON;\n            } else {\n                throw new Error('Babylon is not loaded, setup cannot continue, ensure that window.BABYLON exists')\n            }\n        }\n\n        // Babylon provided by application?\n        if (stage.app.constructor.Babylon) {\n            return stage.app.constructor.Babylon;\n        }\n    },\n\n    setupCameras(stage) {\n        const Babylon = stage.babylon;\n        const camera = new Babylon.UniversalCamera(\"UniversalCamera\", new Babylon.Vector3(0, 0, -10), stage.scene);\n        camera.setTarget(Babylon.Vector3.Zero());\n        camera.attachControl(stage.canvas, true);\n        return [camera];\n    },\n\n    setupEngine(stage) {\n        const Babylon = stage.babylon;\n        const engine = new Babylon.Engine(stage.canvas, true);\n        engine.enableOfflineSupport = false;\n        return engine;\n    },\n\n    setupScene(stage) {\n        const Babylon = stage.babylon;\n        const scene = new Babylon.Scene(stage.engine);\n\n        if (stage.config.showdebuglayer) {\n            scene.debugLayer.show( {\n                globalRoot: document.body,\n                handleResize: true\n            });\n        }\n\n        if (stage.config.backgroundcolor) {\n            scene.clearColor = Babylon.Color3.FromHexString(stage.config.backgroundcolor);\n        }\n\n        return scene;\n    },\n\n    setupLights(stage) {\n        const Babylon = stage.babylon;\n        const light = new Babylon.HemisphericLight('light', new Babylon.Vector3(0, 1, -1), stage.scene);\n        light.intensity = 0.7;\n        return [light];\n    },\n\n\n    async setupWebXR(stage) {\n        const scene = stage.scene;\n        const Babylon = stage.babylon;\n\n        // Check WebXR support in case falling back to WebVR is necessary\n        const environment = scene.createDefaultEnvironment({ enableGroundShadow: true, groundYBias: 1 });\n        const xrHelper = await scene.createDefaultXRExperienceAsync({floorMeshes: [environment.ground]});\n        if(!await xrHelper.baseExperience.sessionManager.supportsSessionAsync(\"immersive-vr\")){\n            const vr = scene.createDefaultVRExperience();\n            vr.fallbackToWebVR = true;\n            return vr;\n        } else {\n            return xrHelper;\n        }\n    },\n};\n","import DefaultApplication from './baseapplication.js';\nimport DefaultStage from './defaultstage.js';\nimport {urlResolve} from \"./url-resolver.js\";\n\n/**\n * Babylon Scene Description\n *\n * @element babylon-scene\n *\n * @fires waiting - Use in combination with the \"customsetup\" attribute to listen for a pause where you can manipulate the stage\n * @fires playing - Fired when the 3D scene is set up and ready for content and interactivity to be added\n *\n * Core Component Attributes\n * @attr {Boolean} customsetup - if true, will stop setup prior to scene creation to allow the consumer to inject custom logic\n * @attr {CustomEvent} onwaiting - \"waiting\" event fires when \"customsetup\" is set to true to allow the consumer to inject custom logic.\n * @attr {CustomEvent} onplaying - \"playing\" event fires when the scene is fully setup and ready for adding logic and 3d objects.\n * @attr {String} app - path to application class module (relative to your HTML file)\n * @attr {String} stage - path to stage setup module (relative to your HTML file)\n *\n * Stage Attributes\n * @attr {Boolean} showdebuglayer - if true will automatically load the Babylon.js inspector UI at start\n * @attr {String} backgroundcolor - when set to a hex color (#ff0000 for red as an example), the Babylon.js background color will be set to this color\n * @attr {Boolean} useglobalbabylon - if true or not set, the Babylon instance defined on window.BABYLON (if found) will be used. Any built version included on a script tag, like from a CDN (https://cdn.babylonjs.com/babylon.js) will put this in place\n *\n * Base Application Attributes\n * @attr {String} addons - An optional comma separated list of addons to automatically use in your application. See add-ons for more details\n *\n * @prop {HTMLCanvasElement} canvas - Canvas used to render 3D scene\n * @prop {Stage} stage - Stage, or scene configuration containing lights, cameras, etc\n * @prop {Object} config - Object containing configuration options for component, stage, and application\n */\n\n\nexport default class BabylonScene extends HTMLElement {\n\n    static get CUSTOM_SETUP() {\n        return 'customsetup';\n    }\n\n    constructor() {\n        super();\n        this.attachShadow({mode: 'open'});\n        this.canvas = document.createElement('canvas');\n        this.shadowRoot.appendChild(this.canvas);\n    }\n\n    init(app) {\n        if (!app) {\n            this.application = new DefaultApplication(this);\n        } else {\n            this.application = app;\n        }\n\n        const listener = this.application.addEventListener('ready', () => {\n            this.application.removeEventListener(listener);\n            this.onSceneCreated();\n        });\n    }\n\n    set stage(val) {\n        this._stage = val;\n        this.init(app);\n    }\n\n    get stage() {\n        return this._stage;\n    }\n\n    onSceneCreated() {\n        const ce = new CustomEvent('playing', {\n            bubbles: true,\n            detail: this.application.stage\n        });\n        this.dispatchEvent(ce);\n        this.sceneIsReady = true;\n    }\n\n    async connectedCallback() {\n        // when using show debug layer, component gets reparented and this is called twice\n        if (this._connectedCallbackFired) { return; }\n        this._connectedCallbackFired = true;\n\n        this.style.display = 'inline-block';\n        this.canvas.style.width = '100%';\n        this.canvas.style.height = '100%';\n\n        this.config = {};\n\n        this.getAttributeNames().forEach( attr => {\n            const val = this.getAttribute(attr) ? this.getAttribute(attr) : true;\n            if (attr !== 'style' && attr !== 'class') {\n                this.config[attr] = val;\n            }\n        });\n\n        this.config.babylonComponent = this;\n\n        if (this.config.stage) {\n            const absPath = urlResolve(this.config.stage).href;\n            const {default: CustomStage} = await import(absPath);\n            this._stage = CustomStage;\n        } else {\n            this._stage = DefaultStage;\n        }\n\n        if (this.config.app) {\n            const absPath = urlResolve(this.config.app).href;\n            const {default: App} = await import(absPath);\n            this.init(new App(this));\n            return;\n        }\n\n        if (!this.config.customsetup) {\n            this.init();\n            return;\n        }\n\n        const ce = new CustomEvent('waiting', {\n            bubbles: true,\n            detail: {\n                canvas: this.canvas,\n                stage: DefaultStage,\n                config: this.config\n            }});\n        this.dispatchEvent(ce);\n    }\n}\n\nif (!customElements.get('babylon-scene')) {\n    customElements.define('babylon-scene', BabylonScene);\n}\n"],"names":["DefaultApplication"],"mappings":"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"}